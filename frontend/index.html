<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Landing Page - Contáctanos</title>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #submitBtn[disabled] {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .g-recaptcha-container {
            transition: border 0.3s ease;
        }
    </style>
</head>
  
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
  <div class="bg-white p-8 rounded-xl shadow-md w-full max-w-md space-y-4">
    <h1 class="text-2xl font-bold text-center text-gray-800">Contáctanos</h1>
    
    <form id="contactForm" class="space-y-4">
      <input 
        type="text" 
        id="name" 
        name="name" 
        placeholder="Nombre completo" 
        required 
        class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200" 
      />
      
      <input 
        type="email" 
        id="email" 
        name="email" 
        placeholder="Correo electrónico" 
        required 
        class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200" 
      />
      
      <input 
        type="tel" 
        id="phone" 
        name="phone" 
        placeholder="Teléfono (opcional)" 
        class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200" 
      />
      
      <textarea 
        id="message" 
        name="message" 
        placeholder="Mensaje" 
        required 
        class="w-full p-3 border border-gray-300 rounded-md h-32 resize-vertical focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200"
      ></textarea>
      
      <!-- reCAPTCHA Container -->
      <div class="flex justify-center py-2 g-recaptcha-container">
        <div class="g-recaptcha" 
              data-sitekey="6Lf2724rAAAAAEUK10pIJpgNENoosBe5hIzQk-6j"
              data-callback="onRecaptchaSuccess"
              data-expired-callback="onRecaptchaExpired"
              data-error-callback="onRecaptchaError">
        </div>
      </div>
      
      <button 
        type="submit" 
        id="submitBtn"
        disabled
        class="w-full bg-blue-500 text-white p-3 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200 font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Enviar
      </button>
    </form>
    
    <!-- Mensaje de respuesta -->
    <div id="responseMessage"></div>
  </div>

  <script>
    // Configuración
    const API_URL = 'http://localhost:3000'; // URL de tu backend Node.js
    const SITE_KEY = '6Lf2724rAAAAAEUK10pIJpgNENoosBe5hIzQk-6j'; // Tu Site Key
    
    // Variables globales
    let recaptchaValid = false;
    
    // Callbacks de reCAPTCHA
    function onRecaptchaSuccess(token) {
      recaptchaValid = true;
      document.getElementById("submitBtn").disabled = false;
      document.querySelector(".g-recaptcha-container").classList.add("border-2", "border-green-300");
      showMessage("¡Verificación completada! Ya puedes enviar el formulario.", "success");
    }
    
    function onRecaptchaExpired() {
      resetRecaptcha();
      showMessage('La verificación ha expirado. Por favor, verifica de nuevo.', 'error');
    }
    
    function onRecaptchaError() {
      resetRecaptcha();
      showMessage('Error al cargar reCAPTCHA. Recarga la página.', 'error');
    }
    
    // Función para resetear reCAPTCHA
    function resetRecaptcha() {
      recaptchaValid = false;
      document.getElementById("submitBtn").disabled = true;
      document.querySelector(".g-recaptcha-container").classList.remove("border-2", "border-green-300");
      if (typeof grecaptcha !== 'undefined') {
        grecaptcha.reset();
      }
    }

    // Manejo del envío del formulario
    document.getElementById("contactForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const responseMessage = document.getElementById('responseMessage');
      
      // Validar reCAPTCHA
      const recaptchaToken = grecaptcha.getResponse();
      if (!recaptchaToken || !recaptchaValid) {
        showMessage('Por favor, completa la verificación de reCAPTCHA', 'error');
        return;
      }
      
      // Validar campos requeridos
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const message = document.getElementById('message').value.trim();
      
      if (!name || !email || !message) {
        showMessage('Por favor, completa todos los campos obligatorios.', 'error');
        return;
      }
      
      // Validar formato de email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showMessage('Por favor, ingresa un email válido.', 'error');
        return;
      }
      
      // Deshabilitar botón durante el envío
      submitBtn.disabled = true;
      submitBtn.innerHTML = `
        <div class="flex items-center justify-center">
          <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Enviando...
        </div>
      `;
      
      // Preparar datos del formulario
      const formData = {
        name: name,
        email: email,
        phone: document.getElementById('phone').value.trim(),
        message: message,
        'g-recaptcha-response': recaptchaToken
      };
      
      try {
        const response = await fetch(`${API_URL}/api/contact`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (response.ok && result.success) {
          showMessage('¡Mensaje enviado correctamente! Te contactaremos pronto.', 'success');
          document.getElementById('contactForm').reset();
          resetRecaptcha();
        } else {
          throw new Error(result.error || 'Error al enviar el mensaje');
        }
      } catch (error) {
        showMessage(error.message || 'Error de conexión. Inténtalo de nuevo.', 'error');
      } finally {
        // Rehabilitar botón
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'Enviar';
      }
    });
    
    // Mostrar mensajes al usuario
    function showMessage(message, type) {
      const responseMessage = document.getElementById('responseMessage');
      
      const bgColor = type === 'success' 
        ? 'bg-green-100 border-green-400 text-green-700' 
        : 'bg-red-100 border-red-400 text-red-700';
      
      responseMessage.innerHTML = `
        <div class="mt-4 px-4 py-3 rounded border ${bgColor}">
          <p class="text-sm font-medium">${message}</p>
        </div>
      `;
      
      // Limpiar mensaje después de 6 segundos
      setTimeout(() => {
        responseMessage.innerHTML = '';
      }, 6000);
    }
    
    // Validación en tiempo real del email
    document.getElementById('email').addEventListener('input', function(e) {
      const email = e.target.value;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (email && !emailRegex.test(email)) {
        e.target.classList.remove('border-gray-300', 'focus:ring-blue-500');
        e.target.classList.add('border-red-400', 'focus:ring-red-500');
      } else {
        e.target.classList.remove('border-red-400', 'focus:ring-red-500');
        e.target.classList.add('border-gray-300', 'focus:ring-blue-500');
      }
    });

    // Animación de entrada del formulario
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('contactForm');
      form.style.opacity = '0';
      form.style.transform = 'translateY(20px)';
      
      setTimeout(() => {
        form.style.transition = 'all 0.5s ease-out';
        form.style.opacity = '1';
        form.style.transform = 'translateY(0)';
      }, 100);
    });
  </script>
</body>
</html>